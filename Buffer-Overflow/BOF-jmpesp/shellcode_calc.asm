;COMPILE: nasm.exe -f win32 shellcode_calc.asm -o shellcode_calc.obj
;LINK: GoLink.exe /console /entry _start shellcode_calc.obj
;IF THE obj FILE IS NOT CREATED WITH THE -f win32 GoLink will COMPLAIN
 
;Tested and coded on Win10

[BITS 32]           ; Specifying target processor mode 32 bits

[SECTION .text]     ; Declare text/code section
global _start       ; Declare entry point
_start:             ; Entry point

;Push the string "calc.exe\0" onto stack
xor ecx,ecx     ; ecx=0
push ecx        ; push \0 (null string terminator) onto the stack
push 0x6578652e ; .exe; little endian; 2e(.) is put at lower address
push 0x636c6163 ; calc; little endian

mov ecx,esp     ; esp points to "calc.exe\0"
push 0x1        ; window style
push ecx        ; first argument for WinExec

mov eax, 7630cf1fh  ; Address of WinExec; RVA=0x5dab0 within kernel32.dll; needs to be changed
inc eax             ; Fix WinExec address
call eax            ; WinExec("calc.exe\0",1)

;exit clean
;xor ecx, ecx   ; ecx=0
;push ecx       ; argument or ExitProcess
;mov eax, 769b4100h ; RVA=0x258f0; The address of ExitProcess may have the \0 byte! e.g. 0x74f94100
;call eax           ; ExitProcess(0)
            
